{% extends "base/base.html" %}

{% block title %}用户登录 - 电子商务系统{% endblock %}

{% block css %}
<style>
    .login-container {
        max-width: 400px;
        margin: 80px auto;
        padding: 30px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .login-title {
        text-align: center;
        font-size: 24px;
        margin-bottom: 30px;
        color: #333;
    }
    .form-group {
        margin-bottom: 20px;
    }
    .form-label {
        display: block;
        margin-bottom: 8px;
        color: #666;
        font-size: 14px;
    }
    .form-input {
        width: 100%;
        height: 40px;
        padding: 0 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
    }
    .login-btn {
        width: 100%;
        height: 45px;
        background: #008CBA;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 18px;
        cursor: pointer;
        margin-top: 10px;
    }
    .link-register {
        text-align: center;
        margin-top: 20px;
        color: #666;
    }
    .link-register a {
        color: #008CBA;
        text-decoration: none;
    }
    .error-message {
        color: #e74c3c;
        text-align: center;
        margin-bottom: 15px;
        height: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div style="max-width: 400px; margin: 50px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">用户登录</h2>
    <form>
        <div style="margin-bottom: 20px;">
            <label for="loginId" style="display: block; margin-bottom: 8px; font-size: 14px;">用户名/手机号</label>
            <input type="text" id="loginId" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="请输入用户名或手机号">
        </div>
        <div style="margin-bottom: 20px;">
            <label for="password" style="display: block; margin-bottom: 8px; font-size: 14px;">密码</label>
            <input type="password" id="password" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="请输入密码">
        </div>
        <button type="button" onclick="login()" style="width: 100%; padding: 12px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">登录</button>
    </form>
</div>
{% endblock %}

{% block js %}
<script>
function login() {
    // 获取输入值
    const loginId = document.getElementById('loginId').value.trim();
    const password = document.getElementById('password').value.trim();

    // 简单校验
    if (!loginId || !password) {
        showToast('请填写完整用户名和密码', false);
        return;
    }

    // 发送登录请求
    fetch('/api/login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ loginId: loginId, password: password })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            // 登录成功：保存用户状态到sessionStorage
            sessionStorage.setItem('username', data.msg.split('，')[1].replace('！', ''));
            sessionStorage.setItem('is_admin', data.is_admin); // 关键：保存管理员标识
            
            // 显示成功提示并跳转到首页
            showToast(data.msg, true);
            setTimeout(() => {
                window.location.href = '/';
            }, 1500);
        } else {
            // 登录失败：显示错误提示
            showToast(data.msg, false);
        }
    })
    .catch(err => {
        showToast('网络错误，请重试', false);
        console.error(err);
    });
}
</script>
{% endblock %}