<!-- frontend/templates/user/index.html -->
{% extends "base/base.html" %}

{% block title %}首页 - 电子商务系统{% endblock %}

{% block css %}
<style>
    /* 轮播图区域 */
    .banner {
        width: 100%;
        height: 350px;
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); /* 渐变背景 */
        border-radius: 10px;
        margin: 20px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 32px;
        font-weight: bold;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        position: relative;
    }

    .banner-text {
        text-align: center;
        z-index: 2;
    }

    .banner-desc {
        font-size: 18px;
        margin-top: 15px;
        opacity: 0.9;
    }

    /* 装饰元素 */
    .banner::before {
        content: '';
        position: absolute;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        top: -50px;
        right: 100px;
    }

    .banner::after {
        content: '';
        position: absolute;
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        bottom: -30px;
        left: 150px;
    }

    /* 推荐商品标题 */
    .recommend-title {
        font-size: 24px;
        margin: 30px 0 20px;
        color: #2c3e50;
        display: flex;
        align-items: center;
    }

    .recommend-title::before {
        content: '';
        width: 4px;
        height: 24px;
        background-color: #3498db;
        margin-right: 10px;
        border-radius: 2px;
    }

    /* 商品列表 */
    .product-list {
        display: flex;
        flex-wrap: wrap;
        gap: 25px;
    }

    /* 商品卡片 */
    .product-card {
        width: calc(25% - 20px); /* 4个卡片一行，减去间距 */
        background-color: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        overflow: hidden;
    }

    .product-card:hover {
        transform: translateY(-5px); /* 轻微上浮 */
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.12); /* 加深阴影 */
    }

    /* 商品图片 */
    .product-img {
        width: 100%;
        height: 200px;
        object-fit: contain; /* 保持图片比例，不拉伸 */
        margin-bottom: 15px;
        background-color: #f8f9fa;
        border-radius: 6px;
        padding: 10px;
    }

    /* 商品名称 */
    .product-name {
        font-size: 18px;
        margin-bottom: 8px;
        color: #2c3e50;
        height: 44px;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2; /* 最多显示2行（WebKit私有属性） */
        line-clamp: 2; /* 补充标准属性（消除警告） */
        -webkit-box-orient: vertical;
    }

    /* 商品分类 */
    .product-category {
        font-size: 14px;
        color: #7f8c8d;
        margin-bottom: 8px;
    }

    /* 商品价格 */
    .product-price {
        font-size: 22px;
        color: #e74c3c;
        font-weight: bold;
        margin: 10px 0;
    }

    /* 按钮样式 */
    .btn-group {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }

    .view-detail {
        flex: 1;
        text-align: center;
        padding: 10px 0;
        background-color: #f1f5f9;
        color: #34495e;
        text-decoration: none;
        border-radius: 6px;
        font-size: 14px;
        transition: background-color 0.3s;
    }

    .view-detail:hover {
        background-color: #e2e8f0;
    }

    .add-to-cart {
        flex: 1;
        padding: 10px 0;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .add-to-cart:hover {
        background-color: #2980b9;
    }
</style>
{% endblock %}

{% block content %}
<!-- 轮播图区域 -->
<div class="banner">
    <div class="banner-text">
        欢迎来到电子商务系统
        <div class="banner-desc">限时优惠 · 全场低至5折 · 满2000减300</div>
    </div>
</div>

<!-- 推荐商品区域 -->
<h2 class="recommend-title">热门推荐商品</h2>
<div class="product-list">
    {% for product in recommended_products %}
    <div class="product-card" 
         data-product-id="{{ product.product_id }}" 
         data-product-name="{{ product.name }}">
        <img src="/static/admin/uploads/products/{{ product.image }}" 
             alt="{{ product.name }}" 
             class="product-img">
        <h3 class="product-name">{{ product.name }}</h3>
        <p class="product-category">分类：{{ product.category }}</p>
        <p class="product-price">¥{{ product.price }}</p>
        <div class="btn-group">
            <a href="/product/{{ product.product_id }}" class="view-detail">查看详情</a>
            <button class="add-to-cart" data-product-id="{{ product.product_id }}">加入购物车</button>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block js %}
<script src="/static/user/js/product.js"></script>
<script>
    // 加入购物车功能
    document.querySelectorAll('.add-to-cart').forEach(btn => {
        btn.addEventListener('click', async function() {
            const productId = this.getAttribute('data-product-id');
            try {
                const response = await fetch('/api/add_to_cart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        product_id: productId,
                        quantity: 1
                    })
                });
                const result = await response.json();
                showToast(result.msg, result.success); // 调用base.html中的提示框函数
            } catch (error) {
                showToast('加入购物车失败', false);
            }
        });
    });
</script>
{% endblock %}